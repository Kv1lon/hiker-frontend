{"ast":null,"code":"import Pagination from \"../components/Pagination\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport axios from \"axios\";\nimport Multiselect from \"@vueform/multiselect\";\nimport VueNumberInput from '@chenfengyuan/vue-number-input';\nimport f from \"./airport.csv\";\nimport { useToast } from \"vue-toastification\";\nimport md from \"./flightsearch.md\";\nimport { VDatePicker } from \"vuetify/lib/labs/VDatePicker\";\nexport default {\n  name: 'tickets',\n  components: {\n    Pagination,\n    'font-awesome-icon': FontAwesomeIcon,\n    Multiselect,\n    VueNumberInput,\n    VDatePicker\n  },\n  data: () => ({\n    listPosts: [],\n    popular: [],\n    user: {},\n    total: 0,\n    next: ``,\n    prev: ``,\n    date: \"\",\n    adult: 1,\n    teen: 0,\n    baby: 0,\n    show: false,\n    showDatePickerTo: false,\n    showDatePickerFrom: false,\n    forward: \"\",\n    back: \"\",\n    trip_class: '',\n    timezone: \"UTC\",\n    modelConfig: {\n      type: 'string',\n      mask: 'YYYY-MM-DD hh:mm:ss',\n      timeAdjust: '24:00:00'\n    },\n    orl: \"\",\n    del: \"\",\n    op: {},\n    arar: {},\n    tickets: [],\n    toast: useToast(),\n    loading: false\n  }),\n  created() {\n    this.loadTickets();\n    this.loadPopularPosts();\n    this.user = this.$store.state.cuser;\n    var data_airports = this.loadCsv(f);\n    this.arar, this.op = data_airports;\n    console.log(this.$store.state);\n  },\n  mounted() {\n    console.log(this.$store.state);\n  },\n  methods: {\n    loadCsv(allText) {\n      var ops = [];\n      var mdd = md.join(\"\");\n      for (var i = 1; i < allText.length; i++) {\n        if (mdd.includes(allText[i][0])) {\n          var st = \"\";\n          for (var j = 0; j < allText[i].length - 2; j++) {\n            st += allText[i][j] + \" \";\n          }\n          allText[i].push(st);\n          ops.push(st);\n        }\n      }\n      allText.shift();\n      return allText, ops;\n    },\n    async loadPopularPosts() {\n      axios({\n        url: this.$store.state.backendUrl + `api/v1/blog?limit=3&search=&date=month&ordering=descending`,\n        method: 'GET',\n        headers: {\n          'Content-type': 'application/json'\n        }\n      }).then(response => {\n        this.popular = response.data.results;\n      });\n    },\n    async loadTickets() {\n      console.log(this.$store.state.ticket);\n      if (this.$store.state.tickets_arr[0]) {\n        console.log(this.$store.state.tickets);\n        this.tickets = this.$store.state.tickets_arr;\n      } else {\n        this.orl = \"ADZ\";\n        this.del = \"AQP\";\n        this.trip_class = \"E\";\n        this.searchTickets();\n      }\n    },\n    async searchTickets() {\n      this.loading = true;\n      var data = \"grant_type=client_credentials&client_id=JxlnVpGLZUn7fV3UPNYfT2IJc0lL1GbE&client_secret=t965p0PRI1cCBS9h\";\n      var token;\n      var access = localStorage.getItem('access');\n      if (access) {\n        delete axios.defaults.headers.common[\"Authorization\"];\n      }\n      await axios({\n        url: 'https://test.api.amadeus.com/v1/security/oauth2/token',\n        data: data,\n        method: 'POST',\n        headers: {\n          \"Content-type\": \"application/x-www-form-urlencoded\"\n        }\n      }).then(response => {\n        console.log(response), token = response.data.token_type + \" \" + response.data.access_token;\n      });\n      this.orl = this.orl.slice(0, 3);\n      this.del = this.del.slice(0, 3);\n      var date = this.forward.toString().slice(10);\n      console.log(this.orl);\n      var data1 = {\n        \"id\": 1,\n        \"originLocationCode\": this.orl,\n        \"destinationLocationCode\": this.del,\n        \"departureDateTimeRange\": {\n          \"date\": this.forward.slice(0, 10),\n          \"time\": this.forward.slice(11)\n        }\n      };\n      if (this.back[0]) {\n        var data2 = {\n          \"id\": 2,\n          \"originLocationCode\": this.del,\n          \"destinationLocationCode\": this.orl,\n          \"departureDateTimeRange\": {\n            \"date\": this.back.slice(0, 10),\n            \"time\": this.back.slice(11)\n          }\n        };\n        var dd = [data1, data2];\n      } else {\n        var dd = [data1];\n      }\n      var travelers = [];\n      var c = 0;\n      for (var i = 0; i < this.adult; i++) {\n        c++;\n        travelers.push({\n          \"id\": c,\n          \"travelerType\": \"ADULT\"\n        });\n      }\n      for (var i = 0; i < this.teen; i++) {\n        c++;\n        travelers.push({\n          \"id\": c,\n          \"travelerType\": \"CHILD\"\n        });\n      }\n      for (var i = 0; i < this.baby; i++) {\n        c++;\n        if (i < this.adult) {\n          travelers.push({\n            \"id\": c,\n            \"travelerType\": \"HELD_INFANT\",\n            \"associatedAdultId\": i + 1\n          });\n        }\n      }\n      var cabin = \"\";\n      if (this.trip_class === \"E\") {\n        cabin = \"ECONOMY\";\n      } else if (this.trip_class === \"PE\") {\n        cabin = \"PREMIUM_ECONOMY\";\n      } else if (this.trip_class === \"B\") {\n        cabin = \"BUSINESS\";\n      } else if (this.trip_class === \"F\") {\n        cabin = \"FIRST\";\n      }\n      var d = {\n        \"currencyCode\": \"USD\",\n        \"originDestinations\": dd,\n        \"travelers\": travelers,\n        \"sources\": [\"GDS\"],\n        \"searchCriteria\": {\n          \"maxFlightOffers\": 20,\n          \"flightFilters\": {\n            \"cabinRestrictions\": [{\n              \"cabin\": cabin,\n              \"coverage\": \"MOST_SEGMENTS\",\n              \"originDestinationIds\": [\"1\"]\n            }],\n            \"carrierRestrictions\": {\n              \"excludedCarrierCodes\": [\"AA\", \"TP\", \"AZ\"]\n            }\n          }\n        }\n      };\n      await axios({\n        url: 'https://test.api.amadeus.com/v2/shopping/flight-offers',\n        data: d,\n        method: 'POST',\n        headers: {\n          \"Authorization\": token\n        }\n      }).then(res => {\n        this.tickets = res.data.data, this.loading = false, data = res.data.data, this.$store.dispatch('tickets_arr', {\n          data\n        }, this.show = false);\n      }).catch(err => {\n        console.log(err), this.toast.error(\"Введіть валідні данні або спробуйте пізніше\"), this.loading = false;\n      });\n      access = localStorage.getItem('access');\n      if (access) {\n        axios.defaults.headers.common['Authorization'] = \"JWT \" + access;\n      }\n    },\n    goTo(name, params) {\n      let r = this.$router.resolve({\n        name: name,\n        params: params // put your route information in\n      });\n\n      window.location.assign(r.href);\n    },\n    format_date(data) {\n      if (data.includes(\"-\")) {\n        return data.slice(0, 10).replaceAll(\"-\", \".\") + \" \" + data.slice(11, 16);\n      } else if (data.includes(\"P\")) {\n        return data.replaceAll(\"P\", \"\").replaceAll(\"T\", \"\").replaceAll(\"D\", \" день(днів) \").replaceAll(\"H\", \" год. \").replaceAll(\"M\", \" хвилин(а) \");\n      }\n    },\n    chooseTicket(data) {\n      this.$store.dispatch('ticket', {\n        data\n      });\n      if (this.$store.state.access) {\n        this.goTo(\"ticket_single\");\n      } else {\n        this.goTo(\"login\");\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}