{"ast":null,"code":"import axios from \"axios\";\nimport Pagination from \"../components/Pagination\";\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport Multiselect from \"@vueform/multiselect\";\nimport VueNumberInput from '@chenfengyuan/vue-number-input';\nimport f from \"./airport.csv\";\nimport md from \"./flightsearch.md\";\nimport { useToast } from \"vue-toastification\";\nimport '@mdi/font/css/materialdesignicons.css';\nimport { VDatePicker } from 'vuetify/labs/VDatePicker';\nexport default {\n  name: 'home',\n  components: {\n    Pagination,\n    'font-awesome-icon': FontAwesomeIcon,\n    Multiselect,\n    VueNumberInput,\n    VDatePicker\n  },\n  data: () => ({\n    popular: [],\n    popular_authors: [],\n    followers_count: null,\n    showDatePickerTo: false,\n    showDatePickerFrom: false,\n    cur_user: {},\n    adult: 1,\n    teen: 0,\n    baby: 0,\n    forward: \"\",\n    back: \"\",\n    trip_class: '',\n    timezone: \"UTC\",\n    modelConfig: {\n      type: 'string',\n      mask: 'YYYY-MM-DD hh:mm:ss',\n      timeAdjust: '24:00:00'\n    },\n    orl: null,\n    del: null,\n    op: {},\n    arar: {},\n    toast: useToast(),\n    loading: false\n  }),\n  created() {\n    this.loadPopularPosts();\n    this.loadPopularAuthors();\n    this.cur_user = this.$store.state.cuser;\n    var data_airports = this.loadCsv(f);\n    this.arar, this.op = data_airports;\n  },\n  methods: {\n    loadCsv(allText) {\n      var mdd = md.join(\"\");\n      var ops = [];\n      for (var i = 1; i < allText.length; i++) {\n        if (mdd.includes(allText[i][0])) {\n          var st = \"\";\n          for (var j = 0; j < allText[i].length - 2; j++) {\n            st += allText[i][j] + \" \";\n          }\n          allText[i].push(st);\n          ops.push(st);\n        }\n      }\n      return allText, ops;\n    },\n    async loadPopularPosts() {\n      axios({\n        url: this.$store.state.backendUrl + `api/v1/blog?limit=5&search=&date=month&ordering=descending`,\n        method: 'GET',\n        headers: {\n          'Content-type': 'application/json'\n        }\n      }).then(response => {\n        this.popular = response.data.results;\n      });\n    },\n    async loadPopularAuthors() {\n      axios({\n        url: this.$store.state.backendUrl + `api/v1/popular_authors`,\n        method: 'GET',\n        headers: {\n          'Content-type': 'application/json'\n        }\n      }).then(response => {\n        this.popular_authors = response.data;\n      });\n    },\n    goTo(name, params) {\n      let r = this.$router.resolve({\n        name: name,\n        params: params // put your route information in\n      });\n\n      window.location.assign(r.href);\n    },\n    async searchTickets() {\n      var data = \"grant_type=client_credentials&client_id=JuRerxA5g2sFoOvNZDgKnQeHkfw72NXo&client_secret=oziTz6ma2cghwzwl\";\n      var token;\n      var access = localStorage.getItem('access');\n      if (access) {\n        delete axios.defaults.headers.common[\"Authorization\"];\n      }\n      this.loading = true;\n      await axios({\n        url: 'https://test.api.amadeus.com/v1/security/oauth2/token',\n        data: data,\n        method: 'POST',\n        headers: {\n          \"Content-type\": \"application/x-www-form-urlencoded\"\n        }\n      }).then(response => {\n        console.log(response), token = response.data.token_type + \" \" + response.data.access_token;\n      });\n      this.orl = this.orl.slice(0, 3);\n      this.del = this.del.slice(0, 3);\n      var date = this.forward.toString().slice(10);\n      var data1 = {\n        \"id\": 1,\n        \"originLocationCode\": this.orl,\n        \"destinationLocationCode\": this.del,\n        \"departureDateTimeRange\": {\n          \"date\": this.forward.slice(0, 10),\n          \"time\": this.forward.slice(11)\n        }\n      };\n      var data2 = {\n        \"id\": 2,\n        \"originLocationCode\": this.del,\n        \"destinationLocationCode\": this.orl,\n        \"departureDateTimeRange\": {\n          \"date\": this.back.slice(0, 10),\n          \"time\": this.back.slice(11)\n        }\n      };\n      var travelers = [];\n      var c = 0;\n      for (var i = 0; i < this.adult; i++) {\n        c++;\n        travelers.push({\n          \"id\": c,\n          \"travelerType\": \"ADULT\"\n        });\n      }\n      for (var i = 0; i < this.teen; i++) {\n        c++;\n        travelers.push({\n          \"id\": c,\n          \"travelerType\": \"CHILD\"\n        });\n      }\n      for (var i = 0; i < this.baby; i++) {\n        c++;\n        if (i < this.adult) {\n          travelers.push({\n            \"id\": c,\n            \"travelerType\": \"HELD_INFANT\",\n            \"associatedAdultId\": i + 1\n          });\n        }\n      }\n      var cabin = \"\";\n      if (this.trip_class === \"E\") {\n        cabin = \"ECONOMY\";\n      } else if (this.trip_class === \"PE\") {\n        cabin = \"PREMIUM_ECONOMY\";\n      } else if (this.trip_class === \"B\") {\n        cabin = \"BUSINESS\";\n      } else if (this.trip_class === \"F\") {\n        cabin = \"FIRST\";\n      }\n      var d = {\n        \"currencyCode\": \"USD\",\n        \"originDestinations\": [data1, data2],\n        \"travelers\": travelers,\n        \"sources\": [\"GDS\"],\n        \"searchCriteria\": {\n          \"maxFlightOffers\": 20,\n          \"flightFilters\": {\n            \"cabinRestrictions\": [{\n              \"cabin\": cabin,\n              \"coverage\": \"MOST_SEGMENTS\",\n              \"originDestinationIds\": [\"1\"]\n            }],\n            \"carrierRestrictions\": {\n              \"excludedCarrierCodes\": [\"AA\", \"TP\", \"AZ\"]\n            }\n          }\n        }\n      };\n      var that = this;\n      await axios({\n        url: 'https://test.api.amadeus.com/v2/shopping/flight-offers',\n        data: d,\n        method: 'POST',\n        headers: {\n          \"Authorization\": token\n        }\n      }).then(res => {\n        if (res.data.data[0]) {\n          data = res.data.data;\n          this.loading = false, this.$store.dispatch('tickets', {\n            data\n          });\n          console.log(this.$store.state), this.goTo(\"tickets\");\n        } else {\n          that.toast.error(\"Немає білетів\"), this.loading = false;\n        }\n      }).catch(err => {\n        console.log(err), that.toast.error(\"Введіть валідні дання або спробйте пізніше\"), this.loading = false;\n      });\n      console.log(this.$store.state.tickets);\n      access = localStorage.getItem('access');\n      if (access) {\n        axios.defaults.headers.common['Authorization'] = \"JWT \" + access;\n      }\n    },\n    async SearchAirport(loc) {\n      var data = \"grant_type=client_credentials&client_id=JuRerxA5g2sFoOvNZDgKnQeHkfw72NXo&client_secret=oziTz6ma2cghwzwl\";\n      var token;\n      var access = localStorage.getItem('access');\n      if (access) {\n        delete axios.defaults.headers.common[\"Authorization\"];\n      }\n      await axios({\n        url: 'https://test.api.amadeus.com/v1/security/oauth2/token',\n        data: data,\n        method: 'POST',\n        headers: {\n          \"Content-type\": \"application/x-www-form-urlencoded\"\n        }\n      }).then(response => {\n        console.log(response), token = response.data.token_type + \" \" + response.data.access_token;\n      });\n      if (loc === \"origin\") {\n        await axios({\n          url: 'https://test.api.amadeus.com/v1/reference-data/locations?subType=AIRPORT&keyword=' + this.orl,\n          method: 'GET',\n          headers: {\n            \"Authorization\": token\n          }\n        }).then(res => console.log(res));\n      } else if (loc === \"destination\") {\n        await axios({\n          url: 'https://test.api.amadeus.com/v1/reference-data/locations?subType=AIRPORT&keyword=' + this.del,\n          method: 'GET',\n          headers: {\n            \"Authorization\": token\n          }\n        }).then(res => console.log(res)).catch(err => {\n          console.log(err), that.toast.error(\"Введите валидные данные или попробуйте позже\");\n        });\n      }\n      access = localStorage.getItem('access');\n      if (access) {\n        axios.defaults.headers.common['Authorization'] = \"JWT \" + access;\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}