(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9eb6d936"],{"373d":function(e,t,o){"use strict";o("4b2e")},"4b2e":function(e,t,o){},c269:function(e,t,o){"use strict";o.r(t);var i=o("7a23");const s=e=>(Object(i["pushScopeId"])("data-v-c8f87cf2"),e=e(),Object(i["popScopeId"])(),e),a={"data-aos":"fade-in","data-aos-delay":"300",class:"modal-body"},n=s(()=>Object(i["createElementVNode"])("h3",null,"Змінити статтю",-1)),r={class:"form-group"},l=s(()=>Object(i["createElementVNode"])("label",{for:"title"},"Назва статті",-1)),c={key:0},d={class:"form-group"},p=s(()=>Object(i["createElementVNode"])("label",null,"Текст",-1)),m={key:0},g={class:"form-group"},h=s(()=>Object(i["createElementVNode"])("label",null,"Короткий опис",-1)),u={key:0},b={key:0,class:"form-group"},f=s(()=>Object(i["createElementVNode"])("label",null,"Оберіть міста",-1)),O={class:"multiselect-tag is-user"},j=["onMousedown"],v={key:1,class:"form-group"},k=s(()=>Object(i["createElementVNode"])("label",null,"Оберіть країни",-1)),V={class:"multiselect-tag is-user"},_=["onMousedown"],y={key:2,class:"form-group"},w=s(()=>Object(i["createElementVNode"])("label",null,"Оберіть теги",-1)),N={class:"multiselect-tag is-user"},E=["onMousedown"],C={class:"form-group"},M=s(()=>Object(i["createElementVNode"])("label",null,"Завантажте фото",-1)),L={key:3,class:"content"},S={class:"cropper-area"},R={class:"img-cropper"},B={class:"preview-area"},T=s(()=>Object(i["createElementVNode"])("label",null,"Обрізане фото",-1)),$={class:"cropped-image"},D=["src"],U={key:1,class:"crop-placeholder"},P={ref:"googleMap",class:"google-map"},I=s(()=>Object(i["createElementVNode"])("div",null,[Object(i["createElementVNode"])("button",{type:"submit",style:{margin:"1px"},class:"btn btn-primary"},"Змінити статтю")],-1));function x(e,t,o,s,x,A){const F=Object(i["resolveComponent"])("ckeditor"),z=Object(i["resolveComponent"])("Multiselect"),G=Object(i["resolveComponent"])("vue-cropper");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",null,[Object(i["createElementVNode"])("div",a,[n,Object(i["createElementVNode"])("form",{onSubmit:t[15]||(t[15]=Object(i["withModifiers"])((...e)=>A.create&&A.create(...e),["prevent"])),style:{margin:"1px"},enctype:"multipart/form-data"},[Object(i["createElementVNode"])("div",r,[l,Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=t=>e.title=t),id:"title",required:""},null,512),[[i["vModelText"],e.title]]),e.msg.title?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",c,Object(i["toDisplayString"])(e.msg.title),1)):Object(i["createCommentVNode"])("",!0)]),Object(i["createElementVNode"])("div",d,[p,Object(i["createVNode"])(F,{class:"form-control",editor:e.editor,modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=t=>e.content=t),config:e.editorConfig},null,8,["editor","modelValue","config"]),e.msg.content?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",m,Object(i["toDisplayString"])(e.msg.content),1)):Object(i["createCommentVNode"])("",!0)]),Object(i["createElementVNode"])("div",g,[h,Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=t=>e.description=t),required:""},null,512),[[i["vModelText"],e.description]]),e.msg.description?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",u,Object(i["toDisplayString"])(e.msg.description),1)):Object(i["createCommentVNode"])("",!0)]),e.opt_cities?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",b,[f,Object(i["createVNode"])(z,{mode:"tags",searchable:!0,modelValue:e.s_cities,"onUpdate:modelValue":t[4]||(t[4]=t=>e.s_cities=t),options:e.opt_cities},{tag:Object(i["withCtx"])(({option:e,handleTagRemove:o,disabled:s})=>[Object(i["createElementVNode"])("div",O,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.value)+" ",1),s?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("i",{key:0,onClick:t[3]||(t[3]=Object(i["withModifiers"])(()=>{},["prevent"])),onMousedown:Object(i["withModifiers"])(t=>o(e,t),["prevent","stop"])},null,40,j))])]),_:1},8,["modelValue","options"])])):Object(i["createCommentVNode"])("",!0),e.opt_countries?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",v,[k,Object(i["createVNode"])(z,{mode:"tags",searchable:!0,modelValue:e.s_countries,"onUpdate:modelValue":t[6]||(t[6]=t=>e.s_countries=t),options:e.opt_countries},{tag:Object(i["withCtx"])(({option:e,handleTagRemove:o,disabled:s})=>[Object(i["createElementVNode"])("div",V,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.value)+" ",1),s?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("i",{key:0,onClick:t[5]||(t[5]=Object(i["withModifiers"])(()=>{},["prevent"])),onMousedown:Object(i["withModifiers"])(t=>o(e,t),["prevent","stop"])},null,40,_))])]),_:1},8,["modelValue","options"])])):Object(i["createCommentVNode"])("",!0),e.opt_tags?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",y,[w,Object(i["createVNode"])(z,{mode:"tags",searchable:!0,modelValue:e.s_tags,"onUpdate:modelValue":t[8]||(t[8]=t=>e.s_tags=t),options:e.opt_tags},{tag:Object(i["withCtx"])(({option:e,handleTagRemove:o,disabled:s})=>[Object(i["createElementVNode"])("div",N,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.value)+" ",1),s?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("i",{key:0,onClick:t[7]||(t[7]=Object(i["withModifiers"])(()=>{},["prevent"])),onMousedown:Object(i["withModifiers"])(t=>o(e,t),["prevent","stop"])},null,40,E))])]),_:1},8,["modelValue","options"])])):Object(i["createCommentVNode"])("",!0),Object(i["createElementVNode"])("div",C,[M,Object(i["createElementVNode"])("input",{class:"form-control-file",ref:"input",type:"file",name:"image",accept:"image/*",onChange:t[9]||(t[9]=(...e)=>A.setImage&&A.setImage(...e))},null,544)]),""!==e.imgSrc?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",L,[Object(i["createElementVNode"])("section",S,[Object(i["createElementVNode"])("div",R,[Object(i["createVNode"])(G,{style:{"max-height":"40vh",display:"block"},ref:"cropper","aspect-ratio":2,src:e.imgSrc,preview:".preview"},null,8,["src"])]),Object(i["createElementVNode"])("div",null,[Object(i["createElementVNode"])("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[10]||(t[10]=Object(i["withModifiers"])(e=>A.rotate(-90),["prevent"]))}," Повернути "),Object(i["createElementVNode"])("a",{ref:"flipX",href:"#",role:"button",class:"btn btn-theme",onClick:t[11]||(t[11]=Object(i["withModifiers"])((...e)=>A.flipX&&A.flipX(...e),["prevent"]))}," Відзеркалити по горизонгталі ",512),Object(i["createElementVNode"])("a",{ref:"flipY",href:"#",role:"button",class:"btn btn-theme",onClick:t[12]||(t[12]=Object(i["withModifiers"])((...e)=>A.flipY&&A.flipY(...e),["prevent"]))}," Відзеркалити по вертикалі ",512),Object(i["createElementVNode"])("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[13]||(t[13]=Object(i["withModifiers"])((...e)=>A.cropImage&&A.cropImage(...e),["prevent"]))}," Обрізати "),Object(i["createElementVNode"])("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[14]||(t[14]=Object(i["withModifiers"])((...e)=>A.reset&&A.reset(...e),["prevent"]))}," Скасувати ")])]),Object(i["createElementVNode"])("section",B,[T,Object(i["createElementVNode"])("div",$,[e.selected_file?(Object(i["openBlock"])(),Object(i["createElementBlock"])("img",{key:0,style:{"max-height":"40vh",display:"block","border-style":"groove"},src:e.selected_file,alt:"Cropped Image"},null,8,D)):(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",U))])])])):Object(i["createCommentVNode"])("",!0),Object(i["createElementVNode"])("div",P,null,512),I],32)])])}var A=o("bc3a"),F=o.n(A),z=o("3730"),G=o.n(z),W=o("95c3"),X=o.n(W),Y=(o("6107"),o("abd1")),Z=o.n(Y),q=o("a306"),H=o("0180"),J={name:"panel_change",props:["slug"],components:{ckeditor:G.a.component,VueCropper:X.a,Multiselect:q["a"]},data:()=>({description:null,cur_user:{},tags:[],cities:[],countries:[],opt_tags:[],opt_cities:[],opt_countries:[],s_tags:[],s_cities:[],s_countries:[],r_tags:[],r_cities:[],r_countries:[],select:null,post:{},title:"",content:"",author:"",selected_file:null,imgSrc:"",editorData:"",msg:[],toast:Object(H["c"])(),markers:[],marker_id:1,latLang:[],LegPoints:[],map:{},directionsService:new google.maps.DirectionsService,directionsRenderer:new google.maps.DirectionsRenderer,bounds:new google.maps.LatLngBounds,mapOptions:{center:{lat:35,lng:100.644},zoomControl:!0,zoom:3,gestureHandling:"auto"},editorConfig:{toolbar:{items:["heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|","imageUpload","blockQuote","insertTable","mediaEmbed","undo","redo"]},language:"ru",image:{toolbar:["imageTextAlternative","imageStyle:alignLeft","imageStyle:inLine","imageStyle:alignRight","toggleImageCaption","imageStyle:alignCenter","imageStyle:centeredImage"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},simpleUpload:{}},editor:Z.a}),created(){this.loadPost(),this.author=this.$store.state.cuser.id,this.loadListTags(),this.loadListCities(),this.loadListCountries()},watch:{content(e){this.content=e,this.validateContent(e)},description(e){this.description=e,this.validateDescription(e)},title(e){this.title=e,this.validateTitle(e)}},mounted(){},methods:{cropImage(){this.selected_file=this.$refs.cropper.getCroppedCanvas().toDataURL()},flipX(){const e=this.$refs.flipX;let t=e.getAttribute("data-scale");t=t?-t:-1,this.$refs.cropper.scaleX(t),e.setAttribute("data-scale",t)},flipY(){const e=this.$refs.flipY;let t=e.getAttribute("data-scale");t=t?-t:-1,this.$refs.cropper.scaleY(t),e.setAttribute("data-scale",t)},reset(){this.$refs.cropper.reset()},rotate(e){this.$refs.cropper.rotate(e)},setImage(e){const t=e.target.files[0];if(-1!==t.type.indexOf("image/"))if("function"===typeof FileReader){const e=new FileReader;e.onload=e=>{this.imgSrc=e.target.result,this.$refs.cropper.replace(e.target.result)},e.readAsDataURL(t)}else this.toast.error("Sorry, FileReader API not supported");else this.toast.warning("Выберите файл с фото")},showFileChooser(){this.$refs.input.click()},zoom(e){this.$refs.cropper.relativeZoom(e)},onFileSelected(e){this.selected_file=e.target.files[0]},async loadPost(){const e=await fetch(`${this.$store.getters.getServerUrl}api/v1/blog/${this.slug}`,{method:"GET",headers:{"Content-type":"application/json"}}).then(e=>e.json()).catch(e=>{let t=this.$router.resolve({name:"404"});window.location.assign(t.href)});if(this.cur_user=this.$store.state.cuser,this.cur_user.username!==e.author){let e=this.$router.resolve({name:"404"});window.location.assign(e.href)}this.post=e,this.title=e.title,this.content=e.content,this.s_cities=e.city,this.s_countries=e.country,this.s_tags=e.tags,this.description=e.description,this.map=new google.maps.Map(this.$refs.googleMap,{center:{lat:35,lng:100.644},zoomControl:!0,zoom:3,gestureHandling:"auto"}),this.initMap(e)},async loadListTags(){F()({url:this.$store.state.backendUrl+"api/v1/tags?limit=100&search=",method:"GET",headers:{"Content-type":"application/json"}}).then(e=>{for(var t in this.tags=e.data,e.data)this.opt_tags.push(e.data[t].name)})},async loadListCities(){F()({url:this.$store.state.backendUrl+"api/v1/city?limit=100&search=",method:"GET",headers:{"Content-type":"application/json"}}).then(e=>{for(var t in this.cities=e.data,e.data)this.opt_cities.push(e.data[t].title)})},async loadListCountries(){F()({url:this.$store.state.backendUrl+"api/v1/country?limit=100&search=",method:"GET",headers:{"Content-type":"application/json"}}).then(e=>{for(var t in this.countries=e.data,e.data)this.opt_countries.push(e.data[t].title)})},validateContent(e){let t=500-e.length;e.length<500?this.msg["content"]="Повинно бути 500 символів! "+t+" залишилось символів":this.msg["content"]=""},validateDescription(e){let t=100-e.length,o=e.length-255;e.length<100?this.msg["description"]="Повинно бути 100 символів! "+t+"залишилось символів":e.length>255?this.msg["description"]="Повинно бути не більше 255 символів! "+o+" зайвих символів":this.msg["description"]=""},validateTitle(e){let t=e.length-255;e.length>255?this.msg["title"]="Повинно бути не більше 255 символів! "+t+" зайвих символів":this.msg["title"]=""},create:function(){if(this.msg["content"]||this.msg["description"]||this.cur_user.username!==this.post.author)this.toast.error("Відбулася помилка. Введіть валідні данні або спробуйте пізніше ");else{const t=new FormData;for(var e in this.s_cities)this.r_cities.push(this.cities.find(t=>t.title===this.s_cities[e]).slug);for(var e in this.s_countries)this.r_countries.push(this.countries.find(t=>t.title===this.s_countries[e]).slug);for(var e in this.s_tags)this.r_tags.push(this.tags.find(t=>t.name===this.s_tags[e]).slug);t.append("title",this.title),t.append("author_id",this.author),t.append("content",this.content);for(let e in this.r_cities)t.append("city",this.r_cities[e]);for(let e in this.r_countries)t.append("country",this.r_countries[e]);for(let e in this.r_tags)t.append("tags",this.r_tags[e]);t.append("description",this.description),null!=this.selected_file&&t.append("img",this.selected_file),F()({url:this.$store.state.backendUrl+"api/v1/edit/"+this.slug,data:t,method:"PUT"}).then(e=>{for(var t in console.log(e),F()({url:this.$store.state.backendUrl+"api/v1/set_points/"+e.data.slug,method:"POST"}).then(e=>{console.log(e)}),this.markers){const o=new FormData;o.append("lng",Number(String(this.markers[t].getPosition().lng()).slice(0,15))),o.append("lat",Number(String(this.markers[t].getPosition().lat()).slice(0,15))),F()({url:this.$store.state.backendUrl+"api/v1/add_point/"+e.data.slug,data:o,method:"POST"}).then(e=>{console.log(e)}),console.log(Number(String(this.markers[t].getPosition().lng()).slice(0,15))),console.log(Number(String(this.markers[t].getPosition().lat()).slice(0,15)))}let o=this.$router.resolve({name:"blog"});window.location.assign(o.href)}).catch(e=>{this.toast.error(" Відбулася помилка. Введіть валідні данні або спробуйте пізніше ")})}},getRoutePointsAndWaypoints(e,t){this.drawRoutePointsAndWaypoints(e,t)},drawRoute(e,t,o,i){var s="";s=o.length>0?{origin:e,destination:t,waypoints:o,optimizeWaypoints:!0,travelMode:google.maps.DirectionsTravelMode.DRIVING}:{origin:e,destination:t,travelMode:google.maps.DirectionsTravelMode.DRIVING};var a=this;this.directionsService.route(s,(function(e,t){if(t===google.maps.DirectionsStatus.OK)a.directionsRenderer.setDirections(e);else if(t===google.maps.DirectionsStatus.ZERO_RESULTS){a.toast.error("Неможливо поставити мітку");for(var o=0;o<a.markers.length;o++)if(a.markers[o].id===i.id)return i.setMap(null),a.markers.splice(o,1),void a.latLang.splice(o,1)}}))},drawRoutePointsAndWaypoints(e,t){var o=new Array;if(e.length>2){for(var i=1;i<e.length-1;i++){var s=e[i];""!==s&&o.push({location:s,stopover:!0})}this.drawRoute(e[0],e[e.length-1],o,t)}else e.length>1?this.drawRoute(e[this.latLang.length-2],e[e.length-1],o,t):this.drawRoute(e[this.latLang.length-1],e[e.length-1],o,t)},placeMarker(e,t){return t.id=this.marker_id,this.marker_id++,this.markers.push(t),t},initMap(e){this.directionsRenderer.setMap(this.map),this.directionsRenderer.setOptions({draggable:!0,suppressMarkers:!0});var t=this;for(var o in e.waypoints){console.log(e.waypoints[o]);var i={lat:Number(e.waypoints[o].lat),lng:Number(e.waypoints[o].lng)};let s=new google.maps.Marker({position:i,map:this.map});t.latLang.push(i),t.LegPoints.push(""),t.placeMarker(this.map,s);let a=s.id;t.getRoutePointsAndWaypoints(t.latLang,s),google.maps.event.addListener(s,"click",(function(e){for(var o=0;o<t.markers.length;o++)if(t.markers[o].id===a)return s.setMap(null),t.markers.splice(o,1),void t.latLang.splice(o,1)}))}google.maps.event.addListener(this.map,"click",(function(e){var o=new google.maps.Marker({position:e.latLng,map:t.map});t.latLang.push(e.latLng),t.LegPoints.push(""),t.getRoutePointsAndWaypoints(t.latLang,o),t.placeMarker(t.map,o);var i=o.id;google.maps.event.addListener(o,"click",(function(e){for(var s=0;s<t.markers.length;s++)if(t.markers[s].id===i)return o.setMap(null),t.markers.splice(s,1),void t.latLang.splice(s,1)}))})),google.maps.event.addListener(this.directionsRenderer,"directions_changed",(function(){var e=this.directionsRenderer.directions.routes[0];CreateRoute(e),t.map.getZoom()}))}}},K=(o("d742"),o("373d"),o("d959")),Q=o.n(K);const ee=Q()(J,[["render",x],["__scopeId","data-v-c8f87cf2"]]);t["default"]=ee}}]);
//# sourceMappingURL=chunk-9eb6d936.eeab998a.js.map