"use strict";(self["webpackChunkhiker"]=self["webpackChunkhiker"]||[]).push([[355],{8355:function(e,t,s){s.r(t),s.d(t,{default:function(){return ve}});var i=s(6252),l=s(6612),a=s(8061);const r=e=>((0,i.dD)("data-v-49180319"),e=e(),(0,i.Cn)(),e),o={key:0,class:"preloader"},n=r((()=>(0,i._)("div",{class:"preloader__image"},null,-1))),c=[n],d={"data-aos":"fade-in","data-aos-delay":"300",class:"edit-profile"},p={class:"container"},m=r((()=>(0,i._)("div",{class:"section-header"},[(0,i._)("h2",{class:"profile_text"},"Зміна профіля")],-1))),u={class:"container"},h={class:"main-body"},g={class:"row gutters-sm"},_={class:"col-md-4 mb-3"},f={class:"card"},b={class:"card-body"},v={class:"d-flex flex-column align-items-center text-center"},y=["src"],w={key:1,src:"https://secure.gravatar.com/avatar/c9877cc06c704dbe1dd3d4f305cb22d6?s=650&d=mm&r=g",style:{"border-radius":"100px"},alt:"Admin",class:"rounded-circle",width:"150"},k={class:"mt-3"},C={class:"profile_text"},x=["innerHTML"],$={class:"text-muted font-size-sm profile_text"},U=r((()=>(0,i._)("div",null,[(0,i._)("label",{for:"upload_pr",class:"btn btn-success"},"Завантажити фото")],-1))),D={key:1,class:"content"},L={class:"cropper-area"},S={class:"img-cropper"},V={class:"preview-area"},I=r((()=>(0,i._)("label",null,"Обрізати фото",-1))),T={class:"cropped-image"},A=["src"],M={key:1,class:"crop-placeholder"},R=(0,i.Uk)(),q={class:"col-md-8"},E={class:"card mb-3"},F={class:"card-body"},Y={class:"row profile_text"},z=r((()=>(0,i._)("div",{class:"col-sm-3"},[(0,i._)("h6",{lass:"mb-0"},"Імя")],-1))),P={class:"col-sm-9 text-secondary p"},X=r((()=>(0,i._)("hr",null,null,-1))),j={class:"row profile_text"},W=r((()=>(0,i._)("div",{class:"col-sm-3"},[(0,i._)("h6",{class:"mb-0"},"Email")],-1))),Z={class:"col-sm-9 text-secondary"},G={key:0},H=r((()=>(0,i._)("hr",null,null,-1))),O={class:"row profile_text"},Q=r((()=>(0,i._)("div",{class:"col-sm-3"},[(0,i._)("h6",{class:"mb-0"},"Адреса")],-1))),B={class:"col-sm-9 text-secondary"},J=r((()=>(0,i._)("hr",null,null,-1))),K={class:"row profile_text"},N=r((()=>(0,i._)("div",{class:"col-sm-3"},[(0,i._)("h6",{class:"mb-0"},"Улюблене")],-1))),ee={class:"col-sm-9 text-secondary"},te=r((()=>(0,i._)("hr",null,null,-1))),se={class:"row profile_text"},ie=r((()=>(0,i._)("div",{class:"col-sm-3"},[(0,i._)("h6",{class:"mb-0"},"Біо")],-1))),le={class:"col-sm-9 text-secondary"},ae=r((()=>(0,i._)("hr",null,null,-1)));function re(e,t,s,r,n,re){const oe=(0,i.up)("vue-cropper"),ne=(0,i.up)("Multiselect"),ce=(0,i.up)("ckeditor");return(0,i.wg)(),(0,i.iD)(i.HY,null,[e.loading?((0,i.wg)(),(0,i.iD)("div",o,c)):(0,i.kq)("",!0),(0,i._)("div",{style:(0,l.j5)({"background-image":"url("+e.user_region.background_img+")",backgroundSize:"100%"})},[(0,i._)("section",d,[(0,i._)("div",p,[m,(0,i._)("div",u,[(0,i._)("div",h,[(0,i._)("div",g,[(0,i._)("div",_,[(0,i._)("div",f,[(0,i._)("div",b,[(0,i._)("div",v,[e.user.profile_img?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.user.profile_img,style:{"border-radius":"100px"},alt:"Admin",class:"rounded-circle",width:"150"},null,8,y)):((0,i.wg)(),(0,i.iD)("img",w)),(0,i._)("div",k,[(0,i._)("h4",C,(0,l.zw)(e.user.username),1),e.user.bio?((0,i.wg)(),(0,i.iD)("p",{key:0,class:"text-secondary mb-1 profile_text",innerHTML:e.user.bio},null,8,x)):(0,i.kq)("",!0),(0,i._)("p",$,(0,l.zw)(e.city),1),(0,i._)("div",null,[(0,i._)("button",{class:"btn btn-dark",onClick:t[0]||(t[0]=(...e)=>re.resetPassword&&re.resetPassword(...e))},"Змінити пароль")]),U,(0,i._)("input",{ref:"input",type:"file",name:"image",accept:"image/*",onChange:t[1]||(t[1]=(...e)=>re.setImage&&re.setImage(...e)),id:"upload_pr"},null,544),""!==e.imgSrc?((0,i.wg)(),(0,i.iD)("div",D,[(0,i._)("section",L,[(0,i._)("div",S,[(0,i.Wm)(oe,{style:{"max-height":"40vh",display:"block"},ref:"cropper","aspect-ratio":1,src:e.imgSrc,preview:".preview"},null,8,["src"])]),(0,i._)("div",null,[(0,i._)("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[2]||(t[2]=(0,a.iM)((e=>re.rotate(-90)),["prevent"]))}," Повернути "),(0,i._)("a",{ref:"flipX",href:"#",role:"button",class:"btn btn-theme",onClick:t[3]||(t[3]=(0,a.iM)(((...e)=>re.flipX&&re.flipX(...e)),["prevent"]))}," Відзеркалити по горизонгталі ",512),(0,i._)("a",{ref:"flipY",href:"#",role:"button",class:"btn btn-theme",onClick:t[4]||(t[4]=(0,a.iM)(((...e)=>re.flipY&&re.flipY(...e)),["prevent"]))}," Відзеркилити по вертикалі ",512),(0,i._)("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[5]||(t[5]=(0,a.iM)(((...e)=>re.cropImage&&re.cropImage(...e)),["prevent"]))}," Обрізати "),(0,i._)("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[6]||(t[6]=(0,a.iM)(((...e)=>re.reset&&re.reset(...e)),["prevent"]))}," Скасувати ")])]),(0,i._)("section",V,[I,(0,i._)("div",T,[e.selected_file?((0,i.wg)(),(0,i.iD)("img",{key:0,style:{"max-height":"40vh",display:"block","border-style":"groove"},src:e.selected_file,alt:"Cropped Image"},null,8,A)):((0,i.wg)(),(0,i.iD)("div",M))])])])):(0,i.kq)("",!0),R,(0,i._)("button",{onClick:t[7]||(t[7]=(...e)=>re.update&&re.update(...e)),class:"btn btn-primary"},"Зберегти")])])])])]),(0,i._)("div",q,[(0,i._)("div",E,[(0,i._)("div",F,[(0,i._)("div",Y,[z,(0,i._)("div",P,[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=t=>e.first_name=t),class:"form-control",placeholder:"Имя пользователя",required:""},null,512),[[a.nr,e.first_name]])])]),X,(0,i._)("div",j,[W,(0,i._)("div",Z,[(0,i.wy)((0,i._)("input",{type:"email","onUpdate:modelValue":t[9]||(t[9]=t=>e.email=t),class:"form-control",placeholder:"email",required:""},null,512),[[a.nr,e.email]]),e.msg.email?((0,i.wg)(),(0,i.iD)("span",G,(0,l.zw)(e.msg.email),1)):(0,i.kq)("",!0)])]),H,(0,i._)("div",O,[Q,(0,i._)("div",B,[(0,i.Wm)(ne,{searchable:!0,modelValue:e.city,"onUpdate:modelValue":t[10]||(t[10]=t=>e.city=t),options:e.opt_cities,required:""},null,8,["modelValue","options"])])]),J,(0,i._)("div",K,[N,(0,i._)("div",ee,[(0,i.Wm)(ne,{searchable:!0,modelValue:e.region,"onUpdate:modelValue":t[11]||(t[11]=t=>e.region=t),options:e.opt_regions,required:""},null,8,["modelValue","options"])])]),te,(0,i._)("div",se,[ie,(0,i._)("div",le,[(0,i.Wm)(ce,{class:"input-text",editor:e.editor,modelValue:e.bio,"onUpdate:modelValue":t[12]||(t[12]=t=>e.bio=t),config:e.editorConfig},null,8,["editor","modelValue","config"])])]),ae])])])])])])])])],4)],64)}var oe=s(9669),ne=s.n(oe),ce=s(7652),de=s(4e3),pe=s.n(de),me=s(8752),ue=s.n(me),he=s(3633),ge=s(3002),_e={components:{ckeditor:pe().component,VueCropper:ce.Z,Multiselect:he.Z},name:"panel_change",props:["slug"],data:()=>({user:{},cur_user:{},username:"",password:"",email:"",selected_file:null,imgSrc:"",first_name:"",city:"",bio:"",error:"",cities:[],opt_cities:[],region:"",regions:[],user_region:{},opt_regions:[],msg:[],oldpas:"",newpas:"",loading:!1,toast:(0,ge.pm)(),editorConfig:{toolbar:{items:["heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|","imageUpload","blockQuote","insertTable","mediaEmbed","undo","redo"]},language:"ru",image:{toolbar:["imageTextAlternative","imageStyle:alignLeft","imageStyle:inLine","imageStyle:alignRight","toggleImageCaption","imageStyle:alignCenter","imageStyle:centeredImage"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},simpleUpload:{uploadUrl:""}},editor:ue()}),watch:{email(e){this.email=e,this.validateEmail(e)}},created(){this.loadUser(),this.loadListCities(),this.loadListRegions(),this.editorConfig.simpleUpload.uploadUrl=this.$store.state.backendUrl+"api/v1/upload_img/none/"},methods:{cropImage(){this.selected_file=this.$refs.cropper.getCroppedCanvas().toDataURL()},flipX(){const e=this.$refs.flipX;let t=e.getAttribute("data-scale");t=t?-t:-1,this.$refs.cropper.scaleX(t),e.setAttribute("data-scale",t)},flipY(){const e=this.$refs.flipY;let t=e.getAttribute("data-scale");t=t?-t:-1,this.$refs.cropper.scaleY(t),e.setAttribute("data-scale",t)},reset(){this.$refs.cropper.reset()},rotate(e){this.$refs.cropper.rotate(e)},setImage(e){const t=e.target.files[0];if(-1!==t.type.indexOf("image/"))if("function"===typeof FileReader){const e=new FileReader;e.onload=e=>{this.imgSrc=e.target.result,this.$refs.cropper.replace(e.target.result)},e.readAsDataURL(t)}else this.toast.error("Простите, FileReader API не поддерживаеться");else this.toast.error("Выберите файл с фото")},showFileChooser(){this.$refs.input.click()},zoom(e){this.$refs.cropper.relativeZoom(e)},onFileSelected(e){this.selected_file=e.target.files[0]},async loadUser(){const e=await fetch(this.$store.state.backendUrl+`api/v1/${this.slug}/`,{method:"GET",headers:{"Content-type":"application/json"}}).then((e=>e.json())).catch((e=>{let t=this.$router.resolve({name:"404"});window.location.assign(t.href)}));if(this.user=e,this.username=e.username,this.first_name=e.first_name,this.email=e.email,this.city=e.city.title,this.region=e.region.title,this.user_region=e.region,this.bio=e.bio,this.cur_user=this.$store.state.cuser,this.user.email!==this.cur_user.email){let e=this.$router.resolve({name:"404"});window.location.assign(e.href)}},loadListCities(){ne()({url:this.$store.state.backendUrl+"api/v1/city",method:"GET",headers:{"Content-type":"application/json"}}).then((e=>{for(var t in this.cities=e.data,e.data)this.opt_cities.push(e.data[t].title)}))},loadListRegions(){ne()({url:this.$store.state.backendUrl+"api/v1/regions",method:"GET",headers:{"Content-type":"application/json"}}).then((e=>{for(var t in this.regions=e.data,e.data)this.opt_regions.push(e.data[t].title)}))},update:function(){if(this.msg["email"]||this.user.email!=this.cur_user.email)this.toast.error(" Произошла ошибка. Введите валидные данные или попробуйте позже ");else{const e=new FormData;this.region&&(this.region=this.regions.find((e=>e.title===this.region)).slug),e.append("first_name",this.first_name),e.append("email",this.email),null!=this.selected_file&&e.append("profile_img",this.selected_file),this.city&&(this.city=this.cities.find((e=>e.title===this.city)).slug),null!=this.city&&e.append("city",this.city),null!=this.region&&e.append("region",this.region),e.append("bio",this.bio),this.loading=!0,ne()({url:this.$store.state.backendUrl+`api/v1/profile_edit/${this.user.slug}/`,data:e,method:"PUT"}).then((e=>{console.log(e),this.loading=!1;let t=this.$router.resolve({name:"home"});window.location.assign(t.href)})).catch((e=>{this.toast.error(" Произошла ошибка. Введите валидные данные или попробуйте позже "),this.loading=!1}))}},validateEmail(e){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)?this.msg["email"]="":this.msg["email"]="Это не похоже на email"},resetPassword(){const e=new FormData;this.loading=!0,e.append("email",this.user.email),ne()({url:this.$store.state.backendUrl+"auth/users/reset_password/",data:e,method:"POST"}).then((e=>{this.loading=!1,this.toast.success("На Вашу почту была выслана ссылка для смены пароля"),console.log(e)}))}}},fe=s(3744);const be=(0,fe.Z)(_e,[["render",re],["__scopeId","data-v-49180319"]]);var ve=be}}]);
//# sourceMappingURL=355.5dddb51b.js.map