"use strict";(self["webpackChunkhiker"]=self["webpackChunkhiker"]||[]).push([[243],{9243:function(e,t,i){i.r(t),i.d(t,{default:function(){return te}});var s=i(6252),o=i(8061),a=i(6612);const n=e=>((0,s.dD)("data-v-0c90d216"),e=e(),(0,s.Cn)(),e),r={"data-aos":"fade-in","data-aos-delay":"300",class:"modal-body"},l=n((()=>(0,s._)("h3",null,"Змінити статтю",-1))),c={class:"form-group"},p=n((()=>(0,s._)("label",{for:"title"},"Назва статті",-1))),d={key:0},g={class:"form-group"},h=n((()=>(0,s._)("label",null,"Текст",-1))),u={key:0},m={class:"form-group"},f=n((()=>(0,s._)("label",null,"Короткий опис",-1))),v={key:0},_={key:0,class:"form-group"},k=n((()=>(0,s._)("label",null,"Оберіть міста",-1))),b={class:"multiselect-tag is-user"},w=["onMousedown"],y={key:1,class:"form-group"},M=n((()=>(0,s._)("label",null,"Оберіть країни",-1))),C={class:"multiselect-tag is-user"},L=["onMousedown"],R={key:2,class:"form-group"},D=n((()=>(0,s._)("label",null,"Оберіть теги",-1))),$={class:"multiselect-tag is-user"},S=["onMousedown"],U={class:"form-group"},T=n((()=>(0,s._)("label",null,"Завантажте фото",-1))),P={key:3,class:"content"},V={class:"cropper-area"},I={class:"img-cropper"},A={class:"preview-area"},q=n((()=>(0,s._)("label",null,"Обрізане фото",-1))),z={class:"cropped-image"},W=["src"],N={key:1,class:"crop-placeholder"},E={ref:"googleMap",class:"google-map"},F=n((()=>(0,s._)("div",null,[(0,s._)("button",{type:"submit",style:{margin:"1px"},class:"btn btn-primary"},"Змінити статтю")],-1)));function O(e,t,i,n,O,x){const G=(0,s.up)("ckeditor"),X=(0,s.up)("Multiselect"),Y=(0,s.up)("vue-cropper");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",r,[l,(0,s._)("form",{onSubmit:t[15]||(t[15]=(0,o.iM)(((...e)=>x.create&&x.create(...e)),["prevent"])),style:{margin:"1px"},enctype:"multipart/form-data"},[(0,s._)("div",c,[p,(0,s.wy)((0,s._)("input",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=t=>e.title=t),id:"title",required:""},null,512),[[o.nr,e.title]]),e.msg.title?((0,s.wg)(),(0,s.iD)("span",d,(0,a.zw)(e.msg.title),1)):(0,s.kq)("",!0)]),(0,s._)("div",g,[h,(0,s.Wm)(G,{class:"form-control",editor:e.editor,modelValue:e.content,"onUpdate:modelValue":t[1]||(t[1]=t=>e.content=t),config:e.editorConfig},null,8,["editor","modelValue","config"]),e.msg.content?((0,s.wg)(),(0,s.iD)("span",u,(0,a.zw)(e.msg.content),1)):(0,s.kq)("",!0)]),(0,s._)("div",m,[f,(0,s.wy)((0,s._)("input",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=t=>e.description=t),required:""},null,512),[[o.nr,e.description]]),e.msg.description?((0,s.wg)(),(0,s.iD)("span",v,(0,a.zw)(e.msg.description),1)):(0,s.kq)("",!0)]),e.opt_cities?((0,s.wg)(),(0,s.iD)("div",_,[k,(0,s.Wm)(X,{mode:"tags",searchable:!0,modelValue:e.s_cities,"onUpdate:modelValue":t[4]||(t[4]=t=>e.s_cities=t),options:e.opt_cities},{tag:(0,s.w5)((({option:e,handleTagRemove:i,disabled:n})=>[(0,s._)("div",b,[(0,s.Uk)((0,a.zw)(e.value)+" ",1),n?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("i",{key:0,onClick:t[3]||(t[3]=(0,o.iM)((()=>{}),["prevent"])),onMousedown:(0,o.iM)((t=>i(e,t)),["prevent","stop"])},null,40,w))])])),_:1},8,["modelValue","options"])])):(0,s.kq)("",!0),e.opt_countries?((0,s.wg)(),(0,s.iD)("div",y,[M,(0,s.Wm)(X,{mode:"tags",searchable:!0,modelValue:e.s_countries,"onUpdate:modelValue":t[6]||(t[6]=t=>e.s_countries=t),options:e.opt_countries},{tag:(0,s.w5)((({option:e,handleTagRemove:i,disabled:n})=>[(0,s._)("div",C,[(0,s.Uk)((0,a.zw)(e.value)+" ",1),n?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("i",{key:0,onClick:t[5]||(t[5]=(0,o.iM)((()=>{}),["prevent"])),onMousedown:(0,o.iM)((t=>i(e,t)),["prevent","stop"])},null,40,L))])])),_:1},8,["modelValue","options"])])):(0,s.kq)("",!0),e.opt_tags?((0,s.wg)(),(0,s.iD)("div",R,[D,(0,s.Wm)(X,{mode:"tags",searchable:!0,modelValue:e.s_tags,"onUpdate:modelValue":t[8]||(t[8]=t=>e.s_tags=t),options:e.opt_tags},{tag:(0,s.w5)((({option:e,handleTagRemove:i,disabled:n})=>[(0,s._)("div",$,[(0,s.Uk)((0,a.zw)(e.value)+" ",1),n?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("i",{key:0,onClick:t[7]||(t[7]=(0,o.iM)((()=>{}),["prevent"])),onMousedown:(0,o.iM)((t=>i(e,t)),["prevent","stop"])},null,40,S))])])),_:1},8,["modelValue","options"])])):(0,s.kq)("",!0),(0,s._)("div",U,[T,(0,s._)("input",{class:"form-control-file",ref:"input",type:"file",name:"image",accept:"image/*",onChange:t[9]||(t[9]=(...e)=>x.setImage&&x.setImage(...e))},null,544)]),""!==e.imgSrc?((0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("section",V,[(0,s._)("div",I,[(0,s.Wm)(Y,{style:{"max-height":"40vh",display:"block"},ref:"cropper","aspect-ratio":2,src:e.imgSrc,preview:".preview"},null,8,["src"])]),(0,s._)("div",null,[(0,s._)("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[10]||(t[10]=(0,o.iM)((e=>x.rotate(-90)),["prevent"]))}," Повернути "),(0,s._)("a",{ref:"flipX",href:"#",role:"button",class:"btn btn-theme",onClick:t[11]||(t[11]=(0,o.iM)(((...e)=>x.flipX&&x.flipX(...e)),["prevent"]))}," Відзеркалити по горизонгталі ",512),(0,s._)("a",{ref:"flipY",href:"#",role:"button",class:"btn btn-theme",onClick:t[12]||(t[12]=(0,o.iM)(((...e)=>x.flipY&&x.flipY(...e)),["prevent"]))}," Відзеркалити по вертикалі ",512),(0,s._)("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[13]||(t[13]=(0,o.iM)(((...e)=>x.cropImage&&x.cropImage(...e)),["prevent"]))}," Обрізати "),(0,s._)("a",{href:"#",role:"button",class:"btn btn-theme",onClick:t[14]||(t[14]=(0,o.iM)(((...e)=>x.reset&&x.reset(...e)),["prevent"]))}," Скасувати ")])]),(0,s._)("section",A,[q,(0,s._)("div",z,[e.selected_file?((0,s.wg)(),(0,s.iD)("img",{key:0,style:{"max-height":"40vh",display:"block","border-style":"groove"},src:e.selected_file,alt:"Cropped Image"},null,8,W)):((0,s.wg)(),(0,s.iD)("div",N))])])])):(0,s.kq)("",!0),(0,s._)("div",E,null,512),F],32)])])}var x=i(9669),G=i.n(x),X=i(4e3),Y=i.n(X),Z=i(7652),j=i(8752),H=i.n(j),B=i(3633),K=i(3002),Q={name:"panel_change",props:["slug"],components:{ckeditor:Y().component,VueCropper:Z.Z,Multiselect:B.Z},data:()=>({description:null,cur_user:{},tags:[],cities:[],countries:[],opt_tags:[],opt_cities:[],opt_countries:[],s_tags:[],s_cities:[],s_countries:[],r_tags:[],r_cities:[],r_countries:[],select:null,post:{},title:"",content:"",author:"",selected_file:null,imgSrc:"",editorData:"",msg:[],toast:(0,K.pm)(),markers:[],marker_id:1,latLang:[],LegPoints:[],map:{},directionsService:new google.maps.DirectionsService,directionsRenderer:new google.maps.DirectionsRenderer,bounds:new google.maps.LatLngBounds,mapOptions:{center:{lat:35,lng:100.644},zoomControl:!0,zoom:3,gestureHandling:"auto"},editorConfig:{toolbar:{items:["heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|","imageUpload","blockQuote","insertTable","mediaEmbed","undo","redo"]},language:"ru",image:{toolbar:["imageTextAlternative","imageStyle:alignLeft","imageStyle:inLine","imageStyle:alignRight","toggleImageCaption","imageStyle:alignCenter","imageStyle:centeredImage"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},simpleUpload:{uploadUrl:""}},editor:H()}),created(){this.loadPost(),this.author=this.$store.state.cuser.id,this.loadListTags(),this.loadListCities(),this.loadListCountries(),this.editorConfig.simpleUpload.uploadUrl=this.$store.state.backendUrl+"api/v1/upload_img/none/"},watch:{content(e){this.content=e,this.validateContent(e)},description(e){this.description=e,this.validateDescription(e)},title(e){this.title=e,this.validateTitle(e)}},mounted(){},methods:{cropImage(){this.selected_file=this.$refs.cropper.getCroppedCanvas().toDataURL()},flipX(){const e=this.$refs.flipX;let t=e.getAttribute("data-scale");t=t?-t:-1,this.$refs.cropper.scaleX(t),e.setAttribute("data-scale",t)},flipY(){const e=this.$refs.flipY;let t=e.getAttribute("data-scale");t=t?-t:-1,this.$refs.cropper.scaleY(t),e.setAttribute("data-scale",t)},reset(){this.$refs.cropper.reset()},rotate(e){this.$refs.cropper.rotate(e)},setImage(e){const t=e.target.files[0];if(-1!==t.type.indexOf("image/"))if("function"===typeof FileReader){const e=new FileReader;e.onload=e=>{this.imgSrc=e.target.result,this.$refs.cropper.replace(e.target.result)},e.readAsDataURL(t)}else this.toast.error("Sorry, FileReader API not supported");else this.toast.warning("Выберите файл с фото")},showFileChooser(){this.$refs.input.click()},zoom(e){this.$refs.cropper.relativeZoom(e)},onFileSelected(e){this.selected_file=e.target.files[0]},async loadPost(){const e=await fetch(`${this.$store.getters.getServerUrl}api/v1/blog/${this.slug}`,{method:"GET",headers:{"Content-type":"application/json"}}).then((e=>e.json())).catch((e=>{let t=this.$router.resolve({name:"404"});window.location.assign(t.href)}));if(this.cur_user=this.$store.state.cuser,this.cur_user.username!==e.author){let e=this.$router.resolve({name:"404"});window.location.assign(e.href)}this.post=e,this.title=e.title,this.content=e.content,this.s_cities=e.city,this.s_countries=e.country,this.s_tags=e.tags,this.description=e.description,this.map=new google.maps.Map(this.$refs.googleMap,{center:{lat:35,lng:100.644},zoomControl:!0,zoom:3,gestureHandling:"auto"}),this.initMap(e)},async loadListTags(){G()({url:this.$store.state.backendUrl+"api/v1/tags?limit=100&search=",method:"GET",headers:{"Content-type":"application/json"}}).then((e=>{for(var t in this.tags=e.data,e.data)this.opt_tags.push(e.data[t].name)}))},async loadListCities(){G()({url:this.$store.state.backendUrl+"api/v1/city?limit=100&search=",method:"GET",headers:{"Content-type":"application/json"}}).then((e=>{for(var t in this.cities=e.data,e.data)this.opt_cities.push(e.data[t].title)}))},async loadListCountries(){G()({url:this.$store.state.backendUrl+"api/v1/country?limit=100&search=",method:"GET",headers:{"Content-type":"application/json"}}).then((e=>{for(var t in this.countries=e.data,e.data)this.opt_countries.push(e.data[t].title)}))},validateContent(e){let t=500-e.length;e.length<500?this.msg["content"]="Повинно бути 500 символів! "+t+" залишилось символів":this.msg["content"]=""},validateDescription(e){let t=100-e.length,i=e.length-255;e.length<100?this.msg["description"]="Повинно бути 100 символів! "+t+"залишилось символів":e.length>255?this.msg["description"]="Повинно бути не більше 255 символів! "+i+" зайвих символів":this.msg["description"]=""},validateTitle(e){let t=e.length-255;e.length>255?this.msg["title"]="Повинно бути не більше 255 символів! "+t+" зайвих символів":this.msg["title"]=""},create:function(){if(this.msg["content"]||this.msg["description"]||this.cur_user.username!==this.post.author)this.toast.error("Відбулася помилка. Введіть валідні данні або спробуйте пізніше ");else{const t=new FormData;for(var e in this.s_cities)this.r_cities.push(this.cities.find((t=>t.title===this.s_cities[e])).slug);for(var e in this.s_countries)this.r_countries.push(this.countries.find((t=>t.title===this.s_countries[e])).slug);for(var e in this.s_tags)this.r_tags.push(this.tags.find((t=>t.name===this.s_tags[e])).slug);t.append("title",this.title),t.append("author_id",this.author),t.append("content",this.content);for(let e in this.r_cities)t.append("city",this.r_cities[e]);for(let e in this.r_countries)t.append("country",this.r_countries[e]);for(let e in this.r_tags)t.append("tags",this.r_tags[e]);t.append("description",this.description),null!=this.selected_file&&t.append("img",this.selected_file),G()({url:this.$store.state.backendUrl+`api/v1/edit/${this.slug}`,data:t,method:"PUT"}).then((e=>{for(var t in console.log(e),G()({url:this.$store.state.backendUrl+`api/v1/set_points/${e.data.slug}`,method:"POST"}).then((e=>{console.log(e)})),this.markers){const i=new FormData;i.append("lng",Number(String(this.markers[t].getPosition().lng()).slice(0,15))),i.append("lat",Number(String(this.markers[t].getPosition().lat()).slice(0,15))),G()({url:this.$store.state.backendUrl+`api/v1/add_point/${e.data.slug}`,data:i,method:"POST"}).then((e=>{console.log(e)})),console.log(Number(String(this.markers[t].getPosition().lng()).slice(0,15))),console.log(Number(String(this.markers[t].getPosition().lat()).slice(0,15)))}let i=this.$router.resolve({name:"blog"});window.location.assign(i.href)})).catch((e=>{this.toast.error(" Відбулася помилка. Введіть валідні данні або спробуйте пізніше ")}))}},getRoutePointsAndWaypoints(e,t){this.drawRoutePointsAndWaypoints(e,t)},drawRoute(e,t,i,s){var o="";o=i.length>0?{origin:e,destination:t,waypoints:i,optimizeWaypoints:!0,travelMode:google.maps.DirectionsTravelMode.DRIVING}:{origin:e,destination:t,travelMode:google.maps.DirectionsTravelMode.DRIVING};var a=this;this.directionsService.route(o,(function(e,t){if(t===google.maps.DirectionsStatus.OK)a.directionsRenderer.setDirections(e);else if(t===google.maps.DirectionsStatus.ZERO_RESULTS){a.toast.error("Неможливо поставити мітку");for(var i=0;i<a.markers.length;i++)if(a.markers[i].id===s.id)return s.setMap(null),a.markers.splice(i,1),void a.latLang.splice(i,1)}}))},drawRoutePointsAndWaypoints(e,t){var i=new Array;if(e.length>2){for(var s=1;s<e.length-1;s++){var o=e[s];""!==o&&i.push({location:o,stopover:!0})}this.drawRoute(e[0],e[e.length-1],i,t)}else e.length>1?this.drawRoute(e[this.latLang.length-2],e[e.length-1],i,t):this.drawRoute(e[this.latLang.length-1],e[e.length-1],i,t)},placeMarker(e,t){return t.id=this.marker_id,this.marker_id++,this.markers.push(t),t},initMap(e){this.directionsRenderer.setMap(this.map),this.directionsRenderer.setOptions({draggable:!0,suppressMarkers:!0});var t=this;for(var i in e.waypoints){console.log(e.waypoints[i]);var s={lat:Number(e.waypoints[i].lat),lng:Number(e.waypoints[i].lng)};let o=new google.maps.Marker({position:s,map:this.map});t.latLang.push(s),t.LegPoints.push(""),t.placeMarker(this.map,o);let a=o.id;t.getRoutePointsAndWaypoints(t.latLang,o),google.maps.event.addListener(o,"click",(function(e){for(var i=0;i<t.markers.length;i++)if(t.markers[i].id===a)return o.setMap(null),t.markers.splice(i,1),void t.latLang.splice(i,1)}))}google.maps.event.addListener(this.map,"click",(function(e){var i=new google.maps.Marker({position:e.latLng,map:t.map});t.latLang.push(e.latLng),t.LegPoints.push(""),t.getRoutePointsAndWaypoints(t.latLang,i),t.placeMarker(t.map,i);var s=i.id;google.maps.event.addListener(i,"click",(function(e){for(var o=0;o<t.markers.length;o++)if(t.markers[o].id===s)return i.setMap(null),t.markers.splice(o,1),void t.latLang.splice(o,1)}))})),google.maps.event.addListener(this.directionsRenderer,"directions_changed",(function(){var e=this.directionsRenderer.directions.routes[0];CreateRoute(e),t.map.getZoom()}))}}},J=i(3744);const ee=(0,J.Z)(Q,[["render",O],["__scopeId","data-v-0c90d216"]]);var te=ee}}]);
//# sourceMappingURL=243.9cc6b593.js.map